<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>Hash Benchmark for mruby</title><link rel="stylesheet" href="/css/main.css"></head><body><header><h1><a href="/">Hash Benchmark for mruby</a></h1><div><a href="https://github.com/shuujii/mruby-hash-benchmark">GitHub</a></div></header><nav id="toc"><ul><li class="active"><a href="#environment" class="h2">Environment</a><ul><li><a href="#benchmark-code" class="h3">Benchmark Code</a></li><li><a href="#implementation" class="h3">Implementation</a></li><li><a href="#platform" class="h3">Platform</a><ul><li><a href="#os" class="h4">OS</a></li><li><a href="#hardware" class="h4">Hardware</a></li></ul></li><li><a href="#compiler" class="h3">Compiler</a></li><li><a href="#type-size" class="h3">Type Size</a></li></ul></li><li><a href="/points-of-improvement" class="h2">Points of Improvement</a></li><li><a href="/memory-usage" class="h2">Memory Usage</a></li><li><a href="/performance" class="h2">Performance</a><ul><li><a href="/performance#basic-operations" class="h3">Basic Operations</a><ul><li><a href="/performance#mrb_hash_set" class="h4"><code>mrb_hash_set</code></a></li><li><a href="/performance#mrb_hash_get" class="h4"><code>mrb_hash_get</code></a></li><li><a href="/performance#mrb_hash_foreach" class="h4"><code>mrb_hash_foreach</code></a></li></ul></li><li><a href="/performance#other-operations" class="h3">Other Operations</a><ul><li><a href="/performance#hash-set" class="h4"><code>Hash#[]=</code></a></li><li><a href="/performance#hash-get" class="h4"><code>Hash#[]</code></a></li><li><a href="/performance#hash-each" class="h4"><code>Hash#each</code></a></li><li><a href="/performance#hash-delete" class="h4"><code>Hash#delete</code></a></li><li><a href="/performance#hash-shift" class="h4"><code>Hash#shift</code></a></li><li><a href="/performance#hash-dup" class="h4"><code>Hash#dup</code></a></li></ul></li></ul></li><li><a href="/binary-size" class="h2">Binary Size</a></li></ul></nav><article id="content">
<h2 id="environment">Environment</h2>

<h3 id="benchmark-code">Benchmark Code</h3>

<ul>
<li><a href="https://github.com/shuujii/mruby-hash-benchmark/tree/2fbb5d299b152244bb8d69f3788041ca07a6c606">github:shuujii/mruby-hash-benchmark@2fbb5d2</a>
</li>
</ul>

<h3 id="implementation">Implementation</h3>
<table><tbody><tr><th>Baseline</th><td><a href="https://github.com/mruby/mruby/tree/8455344bf3fd92ca00f598accfe6b3eb29ddcb0c">github:mruby/mruby@8455344</a></td></tr><tr><th>New</th><td><a href="https://github.com/shuujii/mruby/tree/f2d8db39be487fcd710c5c5844ae47d3a6920e70">github:shuujii/mruby@f2d8db3</a></td></tr></tbody></table>
<h3 id="platform">Platform</h3>

<h4 id="os">OS</h4>
<table><tbody><tr><th>Name</th><td>Linux</td></tr><tr><th>Release</th><td>5.4.0-48-generic</td></tr><tr><th>Version</th><td>#52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020</td></tr></tbody></table>
<h4 id="hardware">Hardware</h4>
<table><caption>CPU 0</caption><tbody><tr><th>vendor_id</th><td>GenuineIntel</td></tr><tr><th>cpu family</th><td>6</td></tr><tr><th>model</th><td>61</td></tr><tr><th>model name</th><td>Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz</td></tr><tr><th>stepping</th><td>4</td></tr><tr><th>cpu MHz</th><td>2699.998</td></tr><tr><th>cache size</th><td>3072 KB</td></tr><tr><th>physical id</th><td>0</td></tr><tr><th>siblings</th><td>2</td></tr><tr><th>core id</th><td>0</td></tr><tr><th>cpu cores</th><td>2</td></tr><tr><th>apicid</th><td>0</td></tr><tr><th>initial apicid</th><td>0</td></tr><tr><th>fpu</th><td>yes</td></tr><tr><th>fpu_exception</th><td>yes</td></tr><tr><th>cpuid level</th><td>20</td></tr><tr><th>wp</th><td>yes</td></tr><tr><th>flags</th><td>fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single pti fsgsbase avx2 invpcid rdseed</td></tr><tr><th>bugs</th><td>cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit srbds</td></tr><tr><th>bogomips</th><td>5399.99</td></tr><tr><th>clflush size</th><td>64</td></tr><tr><th>cache_alignment</th><td>64</td></tr><tr><th>address sizes</th><td>39 bits physical, 48 bits virtual</td></tr><tr><th>power management</th><td></td></tr></tbody></table>

<table><caption>CPU 1</caption><tbody><tr><th>vendor_id</th><td>GenuineIntel</td></tr><tr><th>cpu family</th><td>6</td></tr><tr><th>model</th><td>61</td></tr><tr><th>model name</th><td>Intel(R) Core(TM) i5-5257U CPU @ 2.70GHz</td></tr><tr><th>stepping</th><td>4</td></tr><tr><th>cpu MHz</th><td>2699.998</td></tr><tr><th>cache size</th><td>3072 KB</td></tr><tr><th>physical id</th><td>0</td></tr><tr><th>siblings</th><td>2</td></tr><tr><th>core id</th><td>1</td></tr><tr><th>cpu cores</th><td>2</td></tr><tr><th>apicid</th><td>1</td></tr><tr><th>initial apicid</th><td>1</td></tr><tr><th>fpu</th><td>yes</td></tr><tr><th>fpu_exception</th><td>yes</td></tr><tr><th>cpuid level</th><td>20</td></tr><tr><th>wp</th><td>yes</td></tr><tr><th>flags</th><td>fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single pti fsgsbase avx2 invpcid rdseed</td></tr><tr><th>bugs</th><td>cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit srbds</td></tr><tr><th>bogomips</th><td>5399.99</td></tr><tr><th>clflush size</th><td>64</td></tr><tr><th>cache_alignment</th><td>64</td></tr><tr><th>address sizes</th><td>39 bits physical, 48 bits virtual</td></tr><tr><th>power management</th><td></td></tr></tbody></table>

<table><caption>Memory</caption><tbody><tr><th>MemTotal</th><td>1004628 kB</td></tr></tbody></table>

<h3 id="compiler">Compiler</h3>

<pre><code>gcc (Ubuntu 9.3.0-10ubuntu2) 9.3.0
Copyright (C) 2019 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</code></pre>

<h3 id="type-size">Type Size</h3>
<table><caption>Baseline</caption><thead><tr><th rowspan="2">Type</th><th colspan="5">Size (byte)</th></tr><tr><th>64-bit<br>Word-boxing</th><th>64-bit<br>NaN-boxing</th><th>64-bit<br>No-boxing</th><th>32-bit<br>Word-boxing</th><th>32-bit<br>No-boxing</th></tr></thead><tbody><tr><th><code>void*</code></th><td class="right">8</td><td class="right">8</td><td class="right">8</td><td class="right">4</td><td class="right">4</td></tr><tr><th><code>mrb_value</code></th><td class="right">8</td><td class="right">8</td><td class="right">16</td><td class="right">4</td><td class="right">12</td></tr><tr><th><code>mrb_int</code></th><td class="right">8</td><td class="right">4</td><td class="right">8</td><td class="right">4</td><td class="right">4</td></tr></tbody></table>
<table><caption>New</caption><thead><tr><th rowspan="2">Type</th><th colspan="5">Size (byte)</th></tr><tr><th>64-bit<br>Word-boxing</th><th>64-bit<br>NaN-boxing</th><th>64-bit<br>No-boxing</th><th>32-bit<br>Word-boxing</th><th>32-bit<br>No-boxing</th></tr></thead><tbody><tr><th><code>void*</code></th><td class="right">8</td><td class="right">8</td><td class="right">8</td><td class="right">4</td><td class="right">4</td></tr><tr><th><code>mrb_value</code></th><td class="right">8</td><td class="right">8</td><td class="right">16</td><td class="right">4</td><td class="right">12</td></tr><tr><th><code>mrb_int</code></th><td class="right">8</td><td class="right">4</td><td class="right">8</td><td class="right">4</td><td class="right">4</td></tr></tbody></table>
</article></body></html>
